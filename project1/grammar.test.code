<define PARSE CODE.Program/>
<define TOKEN (("<" "=") (">" "=") ("[" "]") (":" "="))/>

<define KEYWORDS (
    ("hd") 
    ("tl") 
    ("ref") 
    ("not") 
    ("and") 
    ("or") 
    ("while") 
    ("do") 
    ("val") 
    ("int") 
    ("real") 
    ("unit") 
    ("bool")
    ("if")
    ("then")
    ("else")
    ("let")
    ("in")
    )/>

<* 
    p:  CODE.Program
    c:  CODE.Sequence
    s:  CODE.Statement
    d:  CODE.Bind
    t:  CODE.VType
    e2: CODE.Update
/*>

<code Program parse=(CODE.";")/>


<code Bind parse=("val" ID ":" CODE.TType "=" CODE.Update)/>


<* ************************ /*>
<* BEGIN CODE.Update syntax /*>
<* ************************ /*>

<code Update parse=(("(" CODE.Program CODE.UpdateIf ")") 
    | CODE.UpdateIf)/>
<code UpdateIf parse=(("if" CODE.Expression "then" CODE.UpdateIf CODE.UpdateElse) 
    | CODE.UpdateLet)/>
<code UpdateElse parse=("else" CODE.UpdateLet)/>
<code UpdateLet parse=(("let" CODE.Sequence "in" CODE.Program CODE.Update "end") 
    | CODE.UpdateAssign)/>
<code UpdateAssign parse=((CODE.Expression ":=" CODE.UpdateValue)
    | CODE.UpdateValue)/>
<code UpdateValue parse=(Expression)/>

<* ********************** /*>
<* END CODE.Update syntax /*>
<* ********************** /*>


<code Sequence parse=((CODE.Update CODE.SequenceH))/>
<code SequenceH parse=((";" CODE.Update CODE.SequenceH) | "")/>

<* **************************** /*>
<* BEGIN CODE.VType syntax /*>
<* **************************** /*>


<code TType parse=(CODE.TMul CODE.TMulH)/>
<code TMulH parse=(("*" CODE.TMulH) | "")/>
<code TMul parse=((CODE.TTRefH CODE.TList))/>
<code TList parse=(("list" CODE.TList) | "")/>
<code TTRefH parse=((CODE.TBase CODE.TRef))/>
<code TRef parse=(("ref" CODE.TRef) | "")/>
<code TBase parse=("int" | "real" | "unit" | "bool")/>

<* ************************** /*>
<* END CODE.VType syntax /*>
<* ************************** /*>


<* **************************** /*>
<* BEGIN CODE.Expression syntax /*>
<* **************************** /*>

<code Expression parse=(CODE.BoolH CODE.List)/>
<code List parse=(
    ("," CODE.BoolH CODE.List) 
  | "")/>

<code BoolH parse=(CODE.ComparisonH CODE.Bool)/>
<code Bool parse=(
      ("and" CODE.ComparisonH CODE.Bool) 
    | ("or" CODE.ComparisonH CODE.Bool)
    | "")/>

<code ComparisonH parse=(CODE.AddH CODE.Comparison)/>
<code Comparison parse=(
      ("<" CODE.AddH CODE.Comparison) 
    | (">" CODE.AddH CODE.Comparison)
    | ("=" CODE.AddH CODE.Comparison)
    | ("<=" CODE.AddH CODE.Comparison)
    | (">=" CODE.AddH CODE.Comparison)
    | "")/>

<code AddH parse=(CODE.MulH CODE.Add)/>
<code Add parse=(
      ("+" CODE.MulH CODE.Add) 
    | ("-" CODE.MulH CODE.Add) 
    | "")/>

<code MulH parse=(CODE.ConsH CODE.Mul)/>
<code Mul parse=(
      ("*" CODE.ConsH CODE.Mul) 
    | ("/" CODE.ConsH CODE.Mul) 
    | "")/>

<code ConsH parse=(CODE.Unary CODE.Cons)/>
<code Cons parse=(
      ("*" CODE.Unary CODE.Cons) 
    | ("/" CODE.Unary CODE.Cons) 
    | "")/>

<code Unary parse=(
      ("-" CODE.Value)
    | ("hd" CODE.Value)
    | ("tl" CODE.Value)
    | ("ref" CODE.Value)
    | ("!" CODE.Value)
    | ("not" CODE.Value)
    | (CODE.Value))/>

<code Value parse=(
      INT
    | FLOAT
    | ID
    | "[]"
    | ("[" CODE.Expression "]")
    | ("(" CODE.Expression ")"))/>

<* ************************** /*>
<* END CODE.Expression syntax /*>
<* ************************** /*>
